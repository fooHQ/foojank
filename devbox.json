{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.13.6/.schema/devbox.schema.json",
  "packages": [
    "golangci-lint@1.62.0",
    "natscli@latest",
    "upx@latest",
    "capnproto@latest",
    "garble@latest",
    "go@1.23"
  ],
  "env": {
    "GOROOT":      "",
    "GOPATH":      "",
    "CGO_ENABLED": "0"
  },
  "shell": {
    "init_hook": [
      "echo 'Welcome to devbox!' > /dev/null"
    ],
    "scripts": {
      "docs": [
        "docsify server ./docs"
      ],
      "test": [
        "CGO_ENABLED=1 go test -race ./..."
      ],
      "lint": [
        "golangci-lint run"
      ],
      "generate-proto": [
        "test -d ./build/go-capnp || git clone -b v3.0.1-alpha.2 --depth 1 https://github.com/capnproto/go-capnp ./build/go-capnp",
        "cd ./build/go-capnp/capnpc-go && go build . && cd -",
        "go generate ./proto/capnp"
      ],
      "build-runscript": [
        "test ! -z \"$OUTPUT\" || (echo \"OUTPUT variable not defined\" && exit 1)",
        "go build -tags dev -o \"$OUTPUT\" ./cmd/runscript"
      ],

      "build-agent-dev": [
        "test ! -z \"$OUTPUT\" || (echo \"OUTPUT variable not defined\" && exit 1)",
        "CGO_ENABLED=1 go build -race -tags dev -o \"$OUTPUT\" ./cmd/vessel"
      ],
      "build-server-dev": [
        "CGO_ENABLED=1 go build -race -tags dev -o build/server ./cmd/server"
      ],
      "build-client-dev": [
        "CGO_ENABLED=1 go build -race -tags dev -o build/client ./cmd/client"
      ],

      "build-agent-prod": [
        "test ! -z \"$OUTPUT\" || (echo \"OUTPUT variable not defined\" && exit 1)",
        "garble -tiny build -tags prod -o \"$OUTPUT\" ./cmd/vessel"
      ],
      "build-server-prod": [
        "go build -tags prod -o build/server ./cmd/server"
      ],
      "build-client-prod": [
        "go build -tags prod -o build/client ./cmd/client"
      ]
    }
  }
}
