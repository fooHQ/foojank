# Development NATS server

The directory contains a devbox environment that can be used to set up a development NATS server.
If you are following these instructions, you are expected to have a working Foojank client already.
The script is using [nsc](https://github.com/nats-io/nsc).

The server will be listening on:

* `nats://127.0.0.1:4222`
* `ws://127.0.0.1:8080`

## Usage

Setup the environment:

```shell
$ devbox run setup
```

The command will create a configuration file `auth.conf` with a new operator and system account. Once the configuration file
has been created, you can start the server:

```shell
$ devbox run start
```

Open a new terminal and import your account's JWT. The JWT will be signed with the operator's key and pushed to the server:

```shell
$ devbox run import <jwt>
```

Account's JWT can be exported by running `foojank account export <account-name>`.

Finally, configure your client to use the server:

```shell
$ foojank config set --server-url <server-url> --account <account-name>`.
```

## Troubleshooting

If something goes wrong, the easiest way is to start over by cleaning generated files `devbox run clean`.
The command will delete JWTs, keys, and configuration generated by the script.

### Problem: failed to connect: nats: no servers available for connection

The issue occurs when trying to import account JWT when the server is not running. The solution is to start the server in one
terminal window and import the account in another.

